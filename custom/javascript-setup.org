#+TITLE: My JavaScript setup

* my own setup for working in JavaScript

** [[https://ternjs.net/doc/manual.html#emacs][Tern, the "intelligent javascript tooling"]]

*** basic setup
    #+BEGIN_SRC emacs-lisp
    (add-to-list 'load-path "/Users/ryandurling/.emacs.d/submodules/tern/emacs")
    (autoload 'tern-mode "tern.el" nil t)
    (add-hook 'js-mode-hook (lambda () (tern-mode t)))
    #+END_SRC

*** Always find the [[https://github.com/codesuki/add-node-modules-path][nearest node_modules]]

    This file provides add-node-modules-path, which searches the current files parent directories for the
    node_modules/.bin/ directory and adds it to the buffer local exec-path. This allows Emacs to find project
    based installs of e.g. eslint.

    #+BEGIN_SRC emacs-lisp
    (use-package add-node-modules-path
      :ensure t
      :config (eval-after-load 'js-mode
		'(add-hook 'js-mode-hook #'add-node-modules-path)))
    #+END_SRC

*** auto complete

    #+BEGIN_SRC emacs-lisp
    (use-package auto-complete
      :ensure t
      :config
      (add-hook 'js-mode-hook (lambda () (auto-complete-mode t)))
      (eval-after-load 'tern
	'(progn
	   (require 'tern-auto-complete)
	   (tern-ac-setup))))
    #+END_SRC

*** indium

    #+BEGIN_SRC emacs-lisp
    (use-package exec-path-from-shell
      :ensure t
      :custom
      (exec-path-from-shell-check-startup-files nil)
      :config
      (push "HISTFILE" exec-path-from-shell-variables)
      (exec-path-from-shell-initialize))

    (add-hook 'after-init-hook 'global-company-mode)

    (use-package indium
      :ensure t
      :config
      (add-hook 'js-mode-hook #'indium-interaction-mode))
    #+END_SRC

*** Lint

    #+BEGIN_SRC emacs-lisp
    (use-package flycheck
      :defer 1
      :ensure t
      :init (global-flycheck-mode)
      :config
      (defun configure-web-mode-flycheck-checkers ()
	;; in order to have flycheck enabled in web-mode, add an entry to this
	;; cond that matches the web-mode engine/content-type/etc and returns the
	;; appropriate checker.
	(-when-let (checker (cond
			     ((string= web-mode-content-type "jsx")
			      'javascript-eslint)))
	  (flycheck-mode)
	  ;; use the locally installed eslint
	  (let* ((root (locate-dominating-file
			(or (buffer-file-name) default-directory)
			"node_modules"))
		 (eslint (and root
			      (expand-file-name "node_modules/.bin/eslint"
						root))))
	    (when (and eslint (file-executable-p eslint))
	      (setq-local flycheck-javascript-eslint-executable eslint)))

	  (flycheck-select-checker checker)))

      (add-hook 'js-mode-hook #'configure-web-mode-flycheck-checkers))
    #+END_SRC
